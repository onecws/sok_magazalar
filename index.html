<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Mağaza Listesi & Rota Oluşturucu</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f6f9;
        margin: 0;
        padding: 0;
    }

    header {
        background: #004aad;
        color: white;
        padding: 20px;
        text-align: center;
        font-size: 24px;
        font-weight: bold;
        letter-spacing: 0.5px;
    }

    .container {
        max-width: 850px;
        margin: auto;
        padding: 20px;
    }

    .filters {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 15px;
    }

    input, select {
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 16px;
        flex: 1;
        min-width: 180px;
    }

    button {
        background: #004aad;
        color: white;
        border: none;
        padding: 14px 20px;
        font-size: 17px;
        border-radius: 8px;
        cursor: pointer;
        margin-bottom: 20px;
    }

    button:hover {
        background: #00347a;
    }

    .store {
        background: white;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: 0.2s ease;
    }

    .store:hover {
        transform: scale(1.01);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .store b {
        font-size: 18px;
        color: #004aad;
    }

    .distance {
        font-size: 13px;
        color: #666;
    }

    @media(max-width: 600px) {
        header {
            font-size: 20px;
        }
        input, select {
            font-size: 14px;
            padding: 10px;
        }
        button {
            font-size: 15px;
        }
    }
</style>
</head>

<body>

<header>ŞOK Mağaza Listesi & Rota Oluşturucu</header>

<div class="container">

    <div class="filters">
        <input type="text" id="searchInput" placeholder="Mağaza / İl / İlçe ara...">
        <select id="cityFilter"></select>
        <select id="districtFilter"></select>
    </div>

    <button onclick="createRoute()">Google Maps ile Rota Oluştur</button>

    <div id="storeList"></div>

</div>

<script>
let stores = [];
let filtered = [];

async function loadStores() {
    const res = await fetch("magazalar.json");
    stores = await res.json();
    filtered = stores;

    populateCityFilter();
    populateDistrictFilter();
    renderStores();
}

function populateCityFilter() {
    const cities = [...new Set(stores.map(s => s.city))];
    const citySelect = document.getElementById("cityFilter");

    citySelect.innerHTML = "<option value=''>Tüm Şehirler</option>" +
        cities.map(c => `<option value="${c}">${c}</option>`).join("");

    citySelect.onchange = () => {
        const city = citySelect.value;
        if (city) {
            filtered = stores.filter(s => s.city === city);
        } else {
            filtered = stores;
        }
        populateDistrictFilter();
        renderStores();
    };
}

function populateDistrictFilter() {
    const districtSelect = document.getElementById("districtFilter");

    const districts = [...new Set(filtered.map(s => s.district))];

    districtSelect.innerHTML = "<option value=''>Tüm İlçeler</option>" +
        districts.map(d => `<option value="${d}">${d}</option>`).join("");

    districtSelect.onchange = () => {
        const district = districtSelect.value;
        if (district) {
            filtered = filtered.filter(s => s.district === district);
        } else {
            filtered = stores;
        }
        renderStores();
    };
}

document.getElementById("searchInput").oninput = (e) => {
    const q = e.target.value.toLowerCase();
    filtered = stores.filter(s =>
        s.name.toLowerCase().includes(q) ||
        s.city.toLowerCase().includes(q) ||
        s.district.toLowerCase().includes(q)
    );
    renderStores();
};

function renderStores() {
    const container = document.getElementById("storeList");
    container.innerHTML = filtered.map(s => `
        <div class="store">
            <b>${s.name}</b><br>
            ${s.city} / ${s.district}<br>
            ${s.address}<br>
            <span class="distance">${s.distance_km} km uzaklıkta</span>
        </div>
    `).join("");
}

function createRoute() {
    if (filtered.length < 2) {
        alert("Rota için en az 2 mağaza seçilmeli (filtrelediğin mağazalar).");
        return;
    }

    const origin = `${filtered[0].latitude},${filtered[0].longitude}`;
    const destination = `${filtered[filtered.length - 1].latitude},${filtered[filtered.length - 1].longitude}`;
    const waypoints = filtered.slice(1, -1).map(s => `${s.latitude},${s.longitude}`);

    const url =
        "https://www.google.com/maps/dir/?api=1" +
        `&origin=${origin}` +
        `&destination=${destination}` +
        `&waypoints=optimize:true|${waypoints.join("|")}`;

    window.open(url, "_blank");
}

loadStores();
</script>

</body>
</html>
